<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>How&rsquo;s My Hair?</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="manifest" href="site.webmanifest">
    <style>
      body {
        text-align: center;
        font-family: sans-serif;
        margin: auto;
      }

      video {
        border: 3px solid #000;
        width: 480px;
        height: 360px;
        background-color: #333; /* Added a background for when the stream is loading */
      }

      button {
        font-size: 18px;
        padding: 8px;
        display: block;
        margin: auto;
      }

      h1 {
        font-size: 64px;
        text-shadow: 3px 3px 3px #0F0;
      }

      h2 {
        font-size: 20px;
        font-weight: 300;
      }

      main {
        margin-bottom: 34px;
      }

      footer {
        font-family: serif;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>How&rsquo;s My Hair?</h1>
      <h2>The web&rsquo;s #1 utility for checking your hair.</h2>
    </header>
    <main>
      <video autoplay playsinline></video>
      <button onclick="startWebcam()">Check Hair</button>
      <script>
        // Get references to the HTML elements
        const videoElement = document.querySelector("video");
        const buttonElement = document.querySelector("button");

        // This function handles the entire webcam startup process
        async function startWebcam() {
          // Disable the button to prevent multiple clicks
          buttonElement.disabled = true;

          // Check if the browser supports the required API
          if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            try {
              // 1. Request access to the webcam
              const stream = await navigator.mediaDevices.getUserMedia({ 
                video: true 
              });

              // 2. Attach the webcam stream to the video element
              // THIS IS THE KEY FIX: Use srcObject, not URL.createObjectURL()
              videoElement.srcObject = stream;

            } catch (error) {
              // Log the error and alert the user
              console.error("Error accessing the webcam:", error);
              alert("Could not access the webcam. Please ensure you grant permission and are not using another app with the camera.");
              buttonElement.disabled = false; // Re-enable button on error
            }
          } else {
            alert("Sorry, your browser does not support the webcam API.");
          }
        }
      </script>
    </main>
    <footer>Privacy guarantee: <b>Your hair is safe.</b> This image is not saved, stored, or otherwise displayed to anyone but you.</footer>
  </body>
</html>
